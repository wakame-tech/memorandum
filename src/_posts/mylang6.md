---
title: 💻 自作言語インタプリタを作りたい6
date: 2018-08-09
tags: [programming]
vssue: false
---
# 連勤最終日
今日は昼にピアノ教室があったので午前中はピアノを弾いてました。早くうまくなりたい。
ということでこのエントリーはピアノ教室から帰宅して誰もいないリビングで蝉の声を聞きつつ涼風にあたりながら書いています。夏って感じ。  
今日で7連勤の呪縛から開放されます。明日が休みってだけで無限に頑張れる気がする。
残り少ない飲食店厨房バイトを大切にしていきましょう()。

# つづき
# 7/28(10日目)
```
commit 181195aff7f7bd8d295bdf3f85f393bdec9da5ff 'for文を追加、バグ修正、変数の再定義可能に'
commit 685884313022db2d94572fca4beca73254ea05aa 'if式を実装'
```

制御文として必須である `if式` と `for文` を実装しました。 `Arcturus` では `if` は式なので三項演算子のように使うことが出来ます。

### if.ac
```
if(true) {
    println("True")
} else {
    println("False")
}

days: = if(isLeapYear()) { 366 } else { 365 }
```

しかしこの `if式` には `if { ... } else { ... }` のみ対応しておらず、 `else if` に対応していないという欠点があります。  
そこで用意されたのが次の `ガード式` です。

### guard.ac
```
bmi: = 22
result: = 
    bmi < 19 -> "Low" ?
    bmi < 25 -> "Normal" ?
    "Fat"
println(result)
```

`ガード式` は `(条件1) -> (返り値1) ? (条件2) -> (返り値2) ? ... ? (どれにも当てはまらないときの返り値)` のような構造で条件を先頭から判定し最初に真となったものの返り値が返されます。  
はっきり言って `if式` の上位互換です。この `ガード式` は将来的にはパターンマッチにも対応する予定です。  

続いて `for文` を紹介します。
`for` は式ではなく文です。 `Scala` には `for式` なるものがあるらしいのですが。
現時点の `for` は `Range` 型の引数を1つとって範囲の中を増分1でループする仕様です。
まだ逆順やn増分などに対応していないので汎用性は低いです。

### for.ac
```
for(1..15) { i ->
    println(i)
}

start: = 4, end: = 10
for(start..end) { j ->
    println(j)
}
```

この `for文` と `ガード式` を組み合わせることでアレが書けます。

### fizzbuzz.ac
```
fn fizzBuzz(i: Int) -> String {
    i % 15 == 0 -> "FizzBuzz" ?
    i % 3 == 0 -> "Fizz" ?
    i % 5 == 0 -> "Buzz" ?
    str(i)
}

for(1..15) { i ->
    i |> fizzBuzz |> println
}
```

ちょうどこの時実装したパイプライン演算子 `|>` のテストも兼ねて使用しました。
パイプライン演算子は `F#` などで採用されているらしいです。(`i |> fizzBuzz |> println` は `println(fizzBuzz(i))` と等価)  


ということで1つのマイルストーンである `FizzBuzz` を表現することができました。次回でコミットログを振り返るのは終わると思います。